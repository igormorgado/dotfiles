# -*-mode:sh-*- vim:ft=sh


##############################################################################
# PLUGINS
##############################################################################

# Where plugins live
set-environment -g TMUX_PLUGIN_MANAGER_PATH "$HOME/.config/tmux/plugins"

# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# Tmux clipboard
set -g @plugin 'tmux-plugins/tmux-yank'

# Seamless navigation/resizing across Neovim, tmux, kitty
set -g @plugin 'mrjones2014/smart-splits.nvim'

# CPU and memory usage in status bar
set -g @plugin 'tmux-plugins/tmux-mem-cpu-load'

# Highlight prefix / modes in status bar
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'


##############################################################################
# General settings
##############################################################################

# Colors :-)
set -g default-terminal "tmux-256color"
# Enable truecolor for common modern terminals (kitty, wezterm, alacritty) plus tmux itself and xterm.
set -as terminal-features 'kitty:RGB,wezterm:RGB,alacritty:RGB,tmux-256color:RGB,xterm*:RGB'

# MOSE mood
set -g mouse on

# Focus on events enabled for terminals
set -g focus-events on

# Show visually when some pane is updated
set -g visual-activity on

# Start from 1 to follow keyboard order
set -g base-index 1
set -g pane-base-index 1

# No lag for vim
set -sg escape-time 0

# Time for refreshment
set -g display-time 4000

# Renumber windows when some are closed
set  -g renumber-windows on

# Set titles correctly (even on SSH ;-)
set -g set-titles on
set -g set-titles-string "#W [@U@@h]"

# New prefix: C-b is awful
unbind C-b
set -g prefix C-Space
# set -g prefix2 C-n

# Vim mode ftw
set  -g status-keys vi
setw -g mode-keys vi
setw -g xterm-keys on

# Keep a deep scrollback
set -g history-limit 50000

# Keep session alive when last window closes (useful over SSH)
set -g detach-on-destroy off

# Copy and paste handling (bindings provided by tmux-yank)
# bind -T copy-mode-vi y send-keys -X copy-selection
set -g set-clipboard on

# Past buffer vim like
unbind p
bind p paste-buffer

# Enter copy mode
unbind PPage
bind -n S-PPage copy-mode

# Quicker copy-mode exit with Enter
bind -T copy-mode-vi Enter send-keys -X copy-selection-and-cancel

# Reloaded config
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display "Reloaded!"

##############################################################################
# Navigation
##############################################################################

# smart-splits keybindings (match Neovim/Kitty)
set -g @smart-splits_move_left_key    'C-h'
set -g @smart-splits_move_down_key    'C-j'
set -g @smart-splits_move_up_key      'C-k'
set -g @smart-splits_move_right_key   'C-l'

set -g @smart-splits_resize_left_key  'M-h'
set -g @smart-splits_resize_down_key  'M-j'
set -g @smart-splits_resize_up_key    'M-k'
set -g @smart-splits_resize_right_key 'M-l'

set -g @smart-splits_resize_step_size '3'

# Show available panes
bind g display-panes

# Pane split horizontal 
unbind '"'
bind | split-window -h
# Pane split vertical 
unbind %
bind - split-window -v

# Jump to last-window
bind    C-Space  last-window
bind    Space    last-window

# Pane manipulation
# Select the pane you want to bring with prefix-m
# then move to where you want to bring it, then join it
bind m select-pane -m
bind v join-pane -h
bind s join-pane -v
bind V choose-window 'join-pane -h -s "%%"'
bind S choose-window 'join-pane -v -s "%%"'
bind ! break-pane
bind y setw synchronize-panes \; display-message "Sync panes #{?synchronize-panes,on,off}"
bind \{ swap-pane -U
bind \} swap-pane -D

# Pane resize +5
unbind C-Down
unbind C-Left
unbind C-Right
unbind C-Up
bind   -r H resize-pane -L 5
bind   -r J resize-pane -D 5
bind   -r K resize-pane -U 5
bind   -r L resize-pane -R 5

# Binded pane selection VIM like
# Unbinding some defaults being overloaded
unbind \;
unbind M-1
unbind M-2
unbind M-3
unbind M-4
unbind M-5
unbind Left
unbind Down
unbind Up
unbind Right
unbind M-Left
unbind M-Down
unbind M-Up
unbind M-Right
unbind h
unbind j
unbind k
unbind l
# bind                 h   select-pane -L
# bind                 j   select-pane -D
# bind                 k   select-pane -U
# bind                 l   select-pane -R

# Disable clipboard mouse bindings
# unbind -T root MouseDrag1Pane
# unbind -T root WheelUpPane
# set -g set-clipboard on


##############################################################################
# Appearence
##############################################################################

set -g status on
set -g status-interval 5

# Keep active pane size stable across mixed client sizes
setw -g aggressive-resize on

source ~/.config/tmux/darktrial.conf

##############################################################################
# Finishing touch
##############################################################################
run-shell '~/.config/tmux/plugins/tpm/tpm'
